<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualize</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" 
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../static/css/visualize.css"/>
</head>

<body>
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg navbar-light bg-light custom-nav fixed-top w-100 py-3 border-bottom">
            <p class="navbar-brand" style="margin-left: 30px; margin-top: 15px; color: #dcdcdc; font-size: 25px">
              <b> NYC Taxi fare Predictor </b></p>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                  </li>
                  <b>&nbsp;&nbsp;</b>
                  <li class="nav-item">
                    <a class="nav-link" href="/prediction">Predict</a>
                  </li>
                  <b>&nbsp;&nbsp;</b>
                  <li class="nav-item">
                    <a class="nav-link" href="/visualize" style="color: white; font-weight: bold; background-color: #333;">Visualize</a>
                  </li>
                  <b>&nbsp;&nbsp;</b>
                  <li class="nav-item">
                    <a class="nav-link" href="https://data.cityofnewyork.us/Transportation/2018-Yellow-Taxi-Trip-Data/t29m-gskq">Dataset</a>
                  </li>
                </ul>
            </div>
        </nav>
    </div>

            <header class="pt-5">
                <div class="text-box">
                    <h4 id="title">NYC Taxi Dataset Visualization</h4>
                    <hr>
                    <p id="description">Take a look at the visualization for greater insights.</p>
                </div>
            </header>
    
            <h5 class="mt-5 pt-5 px-2 col">Bar Chart</h5>
            <div class="container">
                <p>Observation:</p>
                <p>Hourly variation of pickups - We can see from the above count plots that the number of people booking cabs increases from 6am.</p>
            </div>
            <div class="container-fluid">
                <canvas id="bar_chart"></canvas>
                <script>
                    var ctx = document.getElementById('bar_chart').getContext('2d');

                    var labels = {{ labels | tojson }};
                    var data = {{ data | tojson }};

                    // Combine labels and data into a list of tuples
                    var labelDataTuples = labels.map((l, i) => [l, data[i]]);

                    // Sort the list of tuples based on the label
                    var sortedLabelDataTuples = labelDataTuples.sort((a, b) => a[0] - b[0]);

                    // Extract the sorted labels and data from the sorted list of tuples
                    var sortedLabels = sortedLabelDataTuples.map((t) => t[0]);
                    var sortedData = sortedLabelDataTuples.map((t) => t[1]);

                    var chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: sortedLabels,
                            datasets: [{
                                label: 'Hour in Day',
                                data: sortedData,
                                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#8B008B', '#FFA07A']
                            }]
                        },
                        options: {
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Hourly Variation of Total Number Of Cab Pickups'
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Hour in day - 24 hours Clock'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Total Number of Pickups - Count'
                                    }
                                }
                            }
                        }
                    });
                </script>
            </div>
            
            <h5 class="mt-5 pt-5 px-2 col">Scatter plot</h5>
            <div class="container">
                <p>A scatter plot is a type of data visualization tool that is commonly used to display the relationship between two numerical variables. It is a graphical representation that displays data points as a collection of dots on a two-dimensional coordinate system. In a scatter plot, the two variables being compared are plotted on the x-axis and y-axis, and each data point represents a single observation in the dataset.</p>
                <hr>
                <p>Observation:</p>
                <p>We see a strong linear relationship between the fare amount and trip distance of the cab.
                </p>
            </div>
            <div class="container-fluid">
                <canvas id="scatterplot"></canvas>
                <script>
                    // scatterplot.js
                    const fareAmounts = {{ fare_amounts | tojson }};
                    const tripDistances = {{ trip_distances | tojson }};

                    const scatterData = {
                        datasets: [{
                            label: 'Fare Amount vs. Trip Distance',
                            data: fareAmounts.map((value, index) => ({ x: value, y: tripDistances[index] })),
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }]
                    };

                    const options = {
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Scatter Plot - Fare Amount vs Trip distance'
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Fare Amount - Dollars'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Trip Distance - Miles'
                                    }
                                }
                            }
                        };

                    const scatter_ctx = document.getElementById('scatterplot').getContext('2d');
                    const scatterPlot = new Chart(scatter_ctx, {
                        type: 'scatter',
                        data: scatterData,
                        options: options
                    });

                </script>
            </div>

            
            <h5 class="mt-5 pt-5 px-2 col">Line plot</h5>
            <div class="container">
                <p>Line plots are a way of representing data points connected by a straight line, often used to track changes over time or between variables.This function allows us to specify the type of plot as "line" and specify the x and y axis data columns by name. This is a convenient way to visualize data.</p>
                <hr>
                <p>Observation:</p>
                <p>Plotting the “hour_in_day” vs the “fare_amount” with the hue being months, We observed that the early morning cabs (4 to 6 AM) and the peak hour (4 to 5 pm) cabs are more expensive throughout the months because that is when the work hour starts and ends for the maximum customers in NYC city.</p>
            </div>
            <div class="container-fluid">
                <canvas id="lineplot"></canvas>
                <script>
                    var line_ctx = document.getElementById('lineplot').getContext('2d');
                    fetch('/line_plot')
                    .then(response => response.json())
                    .then(data => {
                        // console.log(data)
                        var chartData = {
                            labels: Array.from(Array(24).keys(), x => parseInt(x)),
                            datasets: []
                        };
                        for (const [month, values] of Object.entries(data)) {
                            chartData.datasets.push({
                                label: `${month}`,
                                data: values.fare_amount,
                                borderColor: `rgb(${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)})`,
                                borderWidth: 1
                            });
                        }
                        var my_line_Chart = new Chart(line_ctx, {
                            type: 'line',
                            data: chartData,
                            options: {
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Hourly Variation of Fare amount Of Cab'
                                    }
                                },
                                scales: {
                                    x: {
                                        title: {
                                            display: true,
                                            text: 'Hour in day - 24 hours Clock'
                                        }
                                    },
                                    y: {
                                        title: {
                                            display: true,
                                            text: 'Average Fare Amount of the Cab - Dollars'
                                        }
                                    }
                                }
                            }
                        });
                    });
                </script>
            </div>

            <h5 class="mt-5 pt-5 px-2 col">Pie Chart</h5>
            <div class="container-fluid">
                <div class="p-3 mt-2 text-center">
                    <a href="/zones" class="btn btn-secondary btn-lg" role="button">Location ID Information</a>
                </div>
                <canvas id="piechart"></canvas>
                <script>
                    fetch('/polar_plot')
                        .then(response => response.json())
                        .then(data => {
                            // console.log(data)
                            var piechartData = {
                                datasets: [{
                                    data: [],
                                    backgroundColor: []
                                }],
                                labels: []
                            };
                            data.forEach(location => {
                                piechartData.datasets[0].data.push(location.count);
                                piechartData.labels.push(location.dropoff_location_id);
                                piechartData.datasets[0].backgroundColor.push(`rgba(${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, 0.5)`);
                            });
                            var pie_ctx = document.getElementById('piechart').getContext('2d');
                            var myPieChart = new Chart(pie_ctx, {
                                type: 'pie',
                                data: piechartData,
                                options: {
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Dropoff Location Count'
                                        },
                                        legend: {
                                            position: 'bottom'
                                        }
                                    } 
                                }
                            });
                        });


                </script>
            </div>

            <h5 class="mt-5 pt-5 px-2 col"> Pie Chart for Day distribution of cabs</h5>
            <div class="container">
                <p>Observation:</p>
                <p>This pie chart shows the days of the week and the percentage of the total number of cabs booked for the particular day of the week.As we can see there is a spike in the number of cabs booked during the mid of the week as these are the days most office goers will have to commute.
                </p>
            </div>
            <div class="container-fluid">
                <canvas id="dayPieChart"></canvas>
                <script>
                    fetch('/day_pie_chart_data')
                        .then(response => response.json())
                        .then(data => {
                            console.log(data)
                            var dayPieChart = new Chart(document.getElementById('dayPieChart'), {
                                type: 'pie',
                                data: {
                                    labels: data.day_labels,
                                    datasets: [{
                                        data: data.day_data,
                                        backgroundColor: ['#ffcd56', '#ff6384', '#36a2eb', '#fd6b19', '#4bc0c0', '#9966ff', '#ffa500']
                                    }]
                                },
                                options: {
                                    title: {
                                        display: true,
                                        text: 'Day distribution of cabs taken'
                                    }
                                }
                            });
                        });
                </script>
            </div>

            <h5 class="mt-5 pt-5 px-2 col">Radar Graph</h5>
            <div class="container">
                <p>Observation:</p>
                <p>From this radar graph, we can see average fare amount of cab for different rate_code destinations.</p>
            </div>
            <div class="container-fluid">
                <canvas id="radarChart"></canvas>
                <script>
                    fetch('/radar_data')
                    .then(response => response.json())
                    .then(data => {
                        console.log(data)
                        var radar_ctx = document.getElementById('radarChart').getContext('2d');
                        var radar_chart = new Chart(radar_ctx, {
                            type: 'radar',
                            data: {
                                labels: data.rate_code_dest,
                                datasets: [{
                                    label: 'Fare Amount',
                                    data: data.fare_amount,
                                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scale: {
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    });
                </script>
            </div>
        
    


</body>
</html>